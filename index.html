<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Create Project Sample</title>
  </head>  
  <body>
    <button id="create-project-button" onclick="load()">Create project</button>
    <img id="image-container" height="420" width="420" />

    <script src="https://sdk.cc-embed.adobe.com/v2/CCEverywhere.js"></script>
    <script type="text/javascript" >
    
    var global_base64 = "";

 

    var projectId = null;

      var imageContainer = document.getElementById("image-container");
        async function LaunchEditor(){
            const ccEverywhere = await window.CCEverywhere.initialize({
                clientId: "951ad175bb2a4eee85863c80996801b3",
                appName: "ACC Adobe Express Editor",
                appVersion: { major: 1, minor: 0 },
                platformCategory: 'web',
                redirectUri: ""
            });
            const createDesignCallback = {
                onCancel: () => {},
                onPublish: (publishParams) => {
                    const localData = { project: publishParams.projectId, image: publishParams.asset.data };
                    imageContainer.src = localData.image;
                    projectId = localData.project;
                },
                onError: (err) => {
                    console.error('Error received is', err.toString());
                },
            };

            ccEverywhere.createDesign(
                {
                    callbacks: createDesignCallback,
                    inputParams: { 
                        asset:{
                            type: 'image',
                            dataType: 'base64',
                            data: global_base64
                        }  
                    },
                    outputParams: {
                        outputType: "base64",
                    }
                }
            );  
        }

 

    
    function getBase64Image(imgUrl, callback) {

 

        var img = new Image();
        img.onload = function(){
            var canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);
            var dataURL = canvas.toDataURL("image/png")

 

            callback(dataURL); // the base64 string

 

        };
        // set attributes and src 
        img.setAttribute('crossOrigin', 'anonymous'); //
        img.src = imgUrl;
    }

   function UrlFunc(){
    var imageUrl = "https://media.istockphoto.com/id/1402586380/vector/click-here-icon-in-flat-style-pointer-clicking-vector-illustration-on-isolated-background.jpg?s=1024x1024&w=is&k=20&c=jRtoVU409FI2CwY_9xwBvp1JuPtG0nCwswdDkncmuOI="; // replace with your image URL
    this.getBase64Image(imageUrl, function(base64image){
        global_base64 = base64image
    });
}

 

    function getImageId(){
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        var id = urlParams.get('id');
        console.log(id)
        document.controller.setValue('/ctx/vars/@id',id);
    }
    function load(){
        UrlFunc();
        LaunchEditor();
        getImageId();
    }
    async function transfer(){
      var img = document.getElementById('image-container').src;
      document.controller.setValue('/ctx/vars/@img',img);
    }

    </script>
  </body> 
</html>
