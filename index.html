<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Image Editor</title>
  </head>
  <body>
    <h1>Image Editor</h1>
    <img id="original-image" height="420" width="420" src="IMAGE_URL" />
    <button id="edit-image">Edit Image</button>
    <img id="edited-image" height="420" width="420" style="display:none" />

    <script src="https://sdk.cc-embed.adobe.com/v2/CCEverywhere.js"></script>
    <script type="text/javascript">
      (async () => {
        const ccEverywhere = await window.CCEverywhere.initialize({
           clientId: "217521108d6645a1b27e01411fb46e85",
            appName: "Adobe Target and Express Integration",
            appVersion: { major: 1, minor: 0 },
            platformCategory: 'web',
            redirectUri: "https://vikas-o7.github.io/Express-Integration/"
        });

        const exportOptions = [
          {
            target: 'Download',
            variant: 'primary',
            optionType: 'button',
            buttonType: 'native',
          },
        ];

        const callbacks = {
          onCancel: () => {},
          onPublish: (publishParams) => {
            const editedImage = document.getElementById('edited-image');
            editedImage.src = publishParams.asset.data;
            editedImage.style.display = 'block';
            const originalImage = document.getElementById('original-image');
            originalImage.style.display = 'none';
          },
          onError: (err) => {
            console.error('Error received is', err.toString());
          },
        };

        document.getElementById('edit-image').addEventListener('click', () => {
          const originalImage = document.getElementById('original-image');
          const canvas = document.createElement('canvas');
          canvas.width = originalImage.width;
          canvas.height = originalImage.height;
          const ctx = canvas.getContext('2d');
          ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);
          const imageUrl = canvas.toDataURL('image/jpeg', 0.8);
          ccEverywhere.openQuickAction({
            id: 'image-crop',
            inputParams: {
              asset: {
                data: imageUrl,
                dataType: 'base64',
                type: 'image',
              },
              exportOptions: exportOptions,
            },
            callbacks: callbacks,
            modalParams: {},
          });
        });
      })();
    </script>
  </body>
</html>
