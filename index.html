<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Create Project Sample</title>
  </head>  
  <body>
    <button id="create-project-button">Create project</button>
    <img id="image-container" height="420" width="420" />
    <script src="https://sdk.cc-embed.adobe.com/v2/CCEverywhere.js"></script>
    <script type="text/javascript">

	var global_base64 = "";
	var projectId = null;
	var imageContainer = document.getElementById("image-container");
	
    async function LaunchEditor(){
        const ccEverywhere = await window.CCEverywhere.initialize({
            clientId: "217521108d6645a1b27e01411fb46e85",
            appName: "Adobe Target and Express Integration",
            appVersion: { major: 1, minor: 0 },
            platformCategory: 'web', 
            redirectUri: ""
        });
		
        const createDesignCallback = {
            onCancel: () => {},
            onPublish: (publishParams) => {
                const localData = { project: publishParams.projectId, image: publishParams.asset.data };
                imageContainer.src = localData.image;
                projectId = localData.project;
            },
            onError: (err) => {
                console.error('Error received is', err.toString());
            },
        };

        ccEverywhere.createDesign(
            {
                callbacks: createDesignCallback,        
                outputParams: {
                    outputType: "base64",
                }
            }
        );  
    }




function getBase64Image(imgUrl, callback) {



    var img = new Image();
    img.onload = function(){
        var canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        var ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0);
        var dataURL = canvas.toDataURL("image/png")



        callback(dataURL); // the base64 string



    };
    // set attributes and src 
    img.setAttribute('crossOrigin', 'anonymous'); //
    img.src = imgUrl;
}




function load(){
    LaunchEditor();
}

async function transfer(){
  var img = document.getElementById('image-container').src;
  document.controller.setValue('/ctx/vars/@img',img);
}

</script>
</body> 
</html>